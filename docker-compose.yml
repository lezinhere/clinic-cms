version: '3.8'

services:
  backend:
    build: ./server
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
      - DATABASE_URL=${DATABASE_URL} # Reads from .env
      - TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}
      - TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}
      - TWILIO_PHONE_NUMBER=${TWILIO_PHONE_NUMBER}
    restart: always

  patient-portal:
    build: .
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}
      - TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}
      - TWILIO_PHONE_NUMBER=${TWILIO_PHONE_NUMBER}
      - NODE_ENV=production
    restart: always
    depends_on:
      - backend

  staff-dashboard:
    build:
      context: ./client
      args:
        VITE_API_URL: http://localhost:5000/api
    ports:
      - "5173:80" # Map host 5173 to container 80
    environment:
      - VITE_API_URL=http://localhost:5000/api # Use appropriate URL
    restart: always

# Note: For VITE_API_URL, if running in browser, "localhost" refers to the user's machine.
# If these containers communicate internally, use service names (e.g. http://backend:5000).
# BUT Client is client-side, so "localhost" is correct for local testing.
